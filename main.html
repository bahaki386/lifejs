<!DOCTYPE HTML>
<html>
<head>
	<title>Life.js - Main</title>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
</head>

<body bgcolor="#000000" text="22ff22">
	<center>
		<img src="top.png"><br>

		<br>
		<canvas id= "LIFE" width="640" height="640"></canvas>
    	<br>
			<form name="ppp">
			<input type="button" onclick="reset" value="reset"></input>
			<input type="button" onclick="next" value="next"></input>
			</form>
	</center>
	<hr>
	<small><pre>Copyright 2014 Haruki Baba ＜h24m33@edu.hachinohe-ct.ac.jp＞</pre></small>
</body>

<script type="text/javascript">

	var pixin=32;
	var canvas=document.getElementById('LIFE');

	window.onload=function (){
		canvas = document.getElementById('LIFE');
			/* canvas要素の存在チェックとCanvas未対応ブラウザの対処 */
		if ( ! canvas || ! canvas.getContext ) {
			return false;
		}
		var pix = prompt("フィールドのサイズを入力してください","");
		pixn =Number(pix);
		life = new Array(pixin);
		var i=0;
		var j=0;
		for (i = 0; i < pixin; i++) {
			life[i] = new Array(pixin);
		}
		i=0;
		for(i=0;i<pixin;i++){
			for(j=0;j<pixin;j++){
				life[i][j]=0;
			}
		}
		var x=0;
		var y=0;
		for(i=0;i<pixin;i++){
		x=Math.round(Math.random()*(pixin-1));
		y=Math.round(Math.random()*(pixin-1));
		life[x][y]=1;
		}
		draw();
	}

	canvas.onmousedown=HndMouse;
	function HndMouse(e){
		adjustXY(e);
		posX=Math.floor(mouseX/s);
		posY=Math.floor(mouseY/s);
		if(life[posX][posY]==1){
			life[posX][posY]=0;
		}
		else{
			life[posX][posY]=1;
		}
		draw(pixin);
	}
	function adjustXY(e) {
		var rect = e.target.getBoundingClientRect();
		mouseX = e.clientX - rect.left;
		mouseY = e.clientY - rect.top;
	}
	function next(){
		getNext();
		draw();
	}
	function reset(){
		var pix = prompt("フィールドのサイズを入力してください","");
		pixnt = Number(pix);
		draw();
	}
	function getNext(){
		nLife=life.copy;
		var i=0;
		var j=0;
		var tmp=0;
		for(j=0;j<pixin;j++){
			for(i=0;i<pixin;i++){
				if(j==0){
					if(i==0){
						tmp=life[i+1][j]+life[i][j+1]+life[i+1][j+1];
					}
					else if(i==(pixin-1)){
						tmp=life[i-1][j]+life[i-1][j+1]+life[i][j+1];
					}
					else{
						tmp=life[i-1][j]+life[i+1][j]+life[i-1][j+1]+life[i][j+1]+life[i+1][j+1];
					}
				}
				else if(j==(pixin-1)){
					if(i==0){
						tmp=life[i][j-1]+life[i+1][j-1]+life[i+1][j];
					}
					else if(i==(pixin-1)){
						tmp=life[i-1][j-1]+life[i][j-1]+life[i-1][j];
					}
					else{
						tmp=life[i-1][j-1]+life[i][j-1]+life[i+1][j-1]+life[i-1][j]+life[i+1][j];
					}
				}
				else{
					if(i==0){
						tmp=life[i][j-1]+life[i+1][j-1]+life[i+1][j]+life[i][j+1]+life[i+1][j+1];
					}
					else if(i==(pixin-1)){
						tmp=life[i-1][j-1]+life[i][j-1]+life[i-1][j]+life[i-1][j+1]+life[i][j+1];
					}
					else{
						tmp=life[i-1][j-1]+life[i][j-1]+life[i+1][j-1]+life[i-1][j]+life[i+1][j]+life[i-1][j+1]+life[i][j+1]+life[i+1][j+1];
					}
				}
				if((tmp<2)||(tmp<3)){
					nLife[i][j]=0;
				}
				else if(tmp==3){
					nLife[i][j]=1;
				}
				life=nLife;
			}
		}
	}

	function draw() {
		s=640/pixin;
		var ctx = canvas.getContext('2d');
		/* 四角を描く */
		ctx.fillStyle='rgb(0,0,0)';
		ctx.fillRect(0,0,640,640);
		ctx.strokeStyle='rgb(0,255,0)';
		ctx.fillStyle='rgb(0,255,0)';
		var i=0;
		var j=0;
		for(j=0;j<pixin;j++){
			for(i=0;i<pixin;i++){
				if(life[i][j]==1){
					ctx.fillRect(i*s,j*s,s,s);
				}
				else{
					ctx.strokeRect(i*s,j*s,s,s);
				}
			}
		}
	}
</script>
</html>
